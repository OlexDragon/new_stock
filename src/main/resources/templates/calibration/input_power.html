<!DOCTYPE html>
<html 	xmlns="http://www.w3.org/1999/xhtml"
		xmlns:th="https://www.thymeleaf.org"
      	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      	lang="en">
<head>
    <meta charset="UTF-8" />
    <title>IRT Bom.</title>
    <link rel="shortcut icon" href="http://irttechnologies.com/favicon.ico">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" data-integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" data-crossorigin="anonymous">
    <link rel="stylesheet" href="../../static/css/components.css" th:href="@{/css/components.css}">
</head>
<body>

<!-- Modal Message -->
	<div id="modal" class="modal" tabindex="-1" role="dialog">
	<th:block th:fragment="converter">
  		<div class="modal-dialog modal-xl">
    		<div class="modal-content">
<!-- Modal Header -->
      			<div class="modal-header">
        			<h5 class="modal-title ml-3 text-primary col">Converter Input Power</h5>
<!-- Calibration settings -->
  					<div class="dropdown col-auto">
  						<button class="btn dropdown-toggle" type="button" id="dropdownSettingsButton" data-bs-toggle="dropdown" aria-expanded="false"></button>
  						<div class="dropdown-menu" aria-labelledby="dropdownSettingsButton">
  							<div class="form-group row">
    							<label class="col-sm-5 col-form-label text-end" for="minValue">Min.:</label>
    							<div class="col-sm-7">
    								<input type="number" class="form-control settings" id="minValue" placeholder="Minimum Value" value="-60">
    							</div>
  							</div>
  							<div class="form-group row">
    							<label class="col-sm-5 col-form-label text-end" for="maxValue">Max.:</label>
    							<div class="col-sm-7">
    								<input type="number" class="form-control settings" id="maxValue" placeholder="Maximum Value" value="0">
    							</div>
  							</div>
  							<div class="form-group row">
    							<label class="col-sm-5 col-form-label text-end" for="step">Step:</label>
    							<div class="col-sm-7">
    								<input type="number" class="form-control settings" id="step" placeholder="Step" value="1">
    							</div>
  							</div>
   						</div>
					</div>
<!-- X Button -->
        			<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      			</div>
 <!-- Modal Body -->
      			<div id="modal-body" class="modal-body">
      			</div>
 <!-- Modal Footer -->
      			<div class="modal-footer">
      				<select id="ipComPorts" class="form-select col"></select>
	        		<button type="button" id="ipStart" class="btn btn-outline-primary disabled">Start</button>
	        		<button type="button" id="ipCalc" class="btn btn-outline-secondary disabled">Stop</button>
	        		<button type="button" id="ipClear" class="btn btn-outline-secondary disabled">Clear</button>
	        		<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
	    		</div>
    		</div>
  		</div>
  		<script th:inline="javascript">
			/*<![CDATA[*/

			$modalBody	 = $('#modal-body');
			$btnStart	 = $('#ipStart');
			$btnStop	 = $('#ipStop');
			var $btnClear= $('#ipClear');
			$minValue= $('#minValue');
			var $maxValue= $('#maxValue');
			var $ipComPorts = $('#ipComPorts');

			// Min. Value
			var inputPowerMinVal = Cookies.get("inputPowerMinVal");
			if(inputPowerMinVal)
				$minValue.val(inputPowerMinVal);

			// Max. Value
			var inputPowerMaxVal = Cookies.get("inputPowerMaxVal");
			if(inputPowerMaxVal)
				$maxValue.val(inputPowerMaxVal);

			gerSerialPorts(ports=>{

				if(!ports){
					alert('It looks like the Serial Port Server is down.');
					return;
				}

				$('<option>', {selected: 'selected', disabled: 'disabled', hidden: 'hidden', title:'Remote Serial Port.', text:'Select Remote Serial Port.'}).appendTo($ipComPorts);

				$.each(ports, function(i, portName){
					$('<option>', {value: portName, text: portName}).appendTo($ipComPorts);
				});
			});
			$ipComPorts.change(e=>{
				const packet = new Packet();
				const bytes = packetToSend(packet);
				$.post('')
			});
		    $('#dropdownSettingsButton').on('hidden.bs.dropdown', function () {
				if(confirm('Do you want to save your changes to the cookies?')){

					const min = $minValue.val();
					if(min)
						Cookies.set("inputPowerMinVal", min);
					else {
						alert('Min. value is missing.');
						$minValue.val(-60);
						return;
					}

					const max = $maxValue.val();
					if(max)
						Cookies.set("inputPowerMaxVal", max);
					else {
						alert('Max. value is missing.');
						$minValue.val(0);
						return;
					}

				}
			});

			$modal.modal('show');
			$modal.on('hidden.bs.modal', function () {
				clearInterval(interval);
				interval = undefined;
				err = null;
			});

			/*]]>*/
			//# sourceURL=converterInputPower.js
  		</script>
	</th:block>
	</div>

    <script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>
    <script type="application/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
	<script type="application/javascript" src="../../static/js/irt.js" th:src="@{/js/irt.js}"></script>
</body>
</html>